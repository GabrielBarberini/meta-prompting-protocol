<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="300" viewBox="0 0 1000 300">
  <defs>
    <style>
      .box { fill: #f8fafc; stroke: #cbd5e1; stroke-width: 1.5; }
      .box-strong { fill: #eef2ff; stroke: #6366f1; stroke-width: 2; }
      .outline { fill: none; stroke: #94a3b8; stroke-width: 1.2; stroke-dasharray: 6 4; }
      .label { font: 13px Arial, sans-serif; fill: #0f172a; }
      .label-soft { font: 12px Arial, sans-serif; fill: #475569; }
      .dashed { stroke-dasharray: 6 4; }
    </style>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#64748b" />
    </marker>
  </defs>

  <rect x="150" y="10" width="640" height="220" rx="12" class="outline" />

  <rect x="20" y="40" width="130" height="50" rx="8" class="box" />
  <text x="85" y="70" class="label" text-anchor="middle">User Goal</text>

  <rect x="170" y="40" width="160" height="50" rx="8" class="box" />
  <text x="250" y="64" class="label" text-anchor="middle">Template Blocks</text>
  <text x="250" y="80" class="label-soft" text-anchor="middle">mutable primers</text>

  <rect x="350" y="20" width="320" height="90" rx="10" class="box-strong" />
  <text x="510" y="42" class="label" text-anchor="middle">Vertical Loop</text>
  <text x="510" y="62" class="label-soft" text-anchor="middle">Architect → Bundle → Executor</text>
  <text x="510" y="78" class="label-soft" text-anchor="middle">QA: open-world gate / closed-world final</text>
  <text x="510" y="94" class="label-soft" text-anchor="middle">Failure feedback → Architect</text>

  <rect x="820" y="40" width="150" height="50" rx="8" class="box" />
  <text x="895" y="70" class="label" text-anchor="middle">Final Response</text>

  <rect x="380" y="150" width="160" height="44" rx="8" class="box" />
  <text x="460" y="176" class="label-soft" text-anchor="middle">Trace Score</text>

  <rect x="590" y="150" width="180" height="44" rx="8" class="box" />
  <text x="680" y="176" class="label-soft" text-anchor="middle">Mutate Blocks</text>

  <text x="455" y="134" class="label-soft" text-anchor="middle">Longitudinal Loop</text>

  <line x1="150" y1="65" x2="170" y2="65" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
  <line x1="330" y1="65" x2="350" y2="65" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
  <line x1="670" y1="65" x2="820" y2="65" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />

  <line x1="510" y1="110" x2="510" y2="150" stroke="#64748b" stroke-width="1.2" class="dashed" marker-end="url(#arrow)" />
  <line x1="540" y1="172" x2="590" y2="172" stroke="#64748b" stroke-width="1.2" class="dashed" marker-end="url(#arrow)" />

  <path d="M680 194 L680 214 L250 214 L250 90" stroke="#64748b" stroke-width="1.2" class="dashed" fill="none" marker-end="url(#arrow)" />
</svg>
